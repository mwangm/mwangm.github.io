layout: page
title: 实现领域驱动设计
date: 2019/6/28 16:58:25
categories:
  - 读书笔记
tags:
  - DDD 微服务
comments: true
---

##### 什么是DDD

软件工程的核心实质是社会工程，不同于传统的软件开发方法，DDD试图分离技术实现的复杂性，围绕业务模型来控制业务的复杂性，以解决软件难以理解，难以演化等问题。

DDD的主要聚焦点在:

1.  领域和领域逻辑;
2. 复杂的领域设计应该基于模型;
3. 技术专家和领域专家一起进行创造性的合作， 渐进迭代式的切入问题领域的核心。


##### 为什么需要DDD

使领域专家和开发者一起工作，让软件准确的传达出业务规则。统一语言，让领域专家和开发人员可以听懂对方，减少鸿沟。设计就是代码，代码就是设计，让软件真正反映出领域专家的思维模型。

##### DDD如何帮助我们

将领域专家和开发团队聚集在一起，创建出一套领域建模的通用语言。

DDD关注业务战略，帮助定义不同团队之间的组织关系，清楚界分不同系统和业务关注点。

DDD战术建模能够帮助开发人员按照领域专家的思维模式开发软件。

**业务价值**：

获得一个有用的领域模型，关注核心域，识别出支撑域。

通过对业务模型的讨论和改善，业务得到更加准确的定义和理解。

领域专家为软件设计做出贡献，知识在开发和领域专家中互相流动。

有领域专家驱动出的业务模型，可以带给用户更好的用户体验。

清晰的模型边界，理解项目的限界上下文，更好了解团队和企业架构。

敏捷和迭代式的持续建模。

#####  实施过程

- 战略建模 - 从宏观角度对整个业务进行拆分，来划分限界上下文。

- 战术建模 - 在限界上下文进行聚合、实体、值对象的建模。

![domain-model](/assets/ddd-model.png)

##### 战略建模
- 限界上下文 - 代表系统，程序或者一种业务服务。通用语言和限界上下文构成了DDD的两大支柱，限界上下文和通用语言存在一一对应关系。
- 通用语言 - 作用于一个特定的界限上下文内。
- 领域 - 公司或者组织运作中的一切。
- 子域 - 一个领域包含一个或者多个子域，理想状况下一个子域对应一个限界上下文, 现实情况中可能是多个；子域又分为核心域、支撑子域和通用子域。
- 支撑子域 - 对应业务的某些重要方面，单不是核心。
- 通用子域 - 某个支撑子域的运用范围是整个系统，那么这个子域便是通用子域。
- 上下文映射图 - 多个限界上下文和子域组成的表示当前单个领域或者多个领域之间的集成关系图。

##### 战术建模

- 实体: 具有唯一标识且具有状态可变性的这么一个领域对象。
- 值对象： 唯一身份标识和可变性是区别实体和值对象的方式。
- 领域服务：操作多个领域对象进行业务操作或者对领域对象进行转换，过度的使用领域服务会导致贫血模型。
- 领域事件：将领域中所发生的活动建模成一些列的离散事件，领域事件是通用语言的组成部分。领域事件可以由本地限界上下文消费，也可以由外部的限界上下文来订阅消费。“通知”可能是需要创建领域事件的一个积极信号。
- 聚合：聚合并不只是将共享父类、密切关联的对象聚集成一个对象树。聚合表达了与事务一致性边界相同的意思。在提交事务时，边界之内的所有内容必须保持一致，边界之外的的任何东西都是与聚合不相关的。在设计聚合时，我们必须把事务考虑在内， 我们考虑的是事务的一致性边界，而不是创建一个对象树。 小聚合不仅在性能和伸缩性上的好处，还可以减少事务提交冲突，有助于事务的成功执行。
- 工厂： 实体和聚合通常是很复杂的，这就导致了很难去通过构造器来创建对象。工厂就决解了这个问题，它把创建对象的细节封装起来。
- 仓库：封装了获取对象的逻辑，领域对象无须和底层数据库交互，它只需要从仓库中获取对象即可。

##### 典型DDD代码分层结构

   - User Interface-负责向用户展现信息，并且会解析用户行为，即常说的展现层
   - Application - 数据业务验证、事务、多个聚合的协调操作
   - Domain - 战术建模的体现：聚合、实体、值对象...
   - infrastructure - 辅助支撑类库，关连具体实现，e.g 仓储、通用支撑类库

##### 六边形架构

  <https://insights.thoughtworks.cn/from-sandwich-to-hexagon/>